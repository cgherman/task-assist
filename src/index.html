<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>TaskAssist</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <app-root></app-root>
    <script type="text/javascript" src="https://ajax.microsoft.com/ajax/jQuery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript">
      function handleClientLoad() {
        // Loads the client library and the auth2 library together for efficiency.
        // Loading the auth2 library is optional here since `gapi.client.init` function will load
        // it if not already loaded. Loading it upfront can save one network request.

        gapi.load('client:auth2', initClientWithSettings);
      }

      function initClientWithSettings() {
        $.getJSON('/assets/api_key.json', function(data) {
          initClient(data.api_key, data.client_id);
        });
      }

      function initClient(api_key, client_id) {
        // 1) Initialize the client with API key and discovery URL for the Tasks API
        // 2) initialize OAuth with an OAuth 2.0 client ID
        // 3) Adjust scopes (space delimited string) as needed to request access.
        gapi.client.init({
            apiKey: api_key,
            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest"],
            clientId: client_id,
            scope: 'https://www.googleapis.com/auth/tasks'
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        });
      }

      function updateSigninStatus(isSignedIn) {
        // When signin status changes, this function is called.
        // If the signin status is changed to signedIn, we make an API call.
        if (isSignedIn) {
          makeApiCall();
        }
      }

      function handleSignInClick(event) {
        // Ideally the button should only show up after gapi.client.init finishes, so that this
        // handler won't be called before OAuth is initialized.
        gapi.auth2.getAuthInstance().signIn();
      }

      function handleSignOutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      function makeApiCall() {
        gapi.client.tasks.tasklists.list({
        }).then(function(response) {
//for (TaskList taskList : taskLists.getItems()) {
//  System.out.println(taskList.getTitle());
//}
          console.log('Successful fetch of Task List: "' + response.result.items[0].title + '"');
        }, function(rejectReason) {
          console.log('Error: ' + rejectReason.result.error.message);
        });
      }
    </script>
    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <button id="signin-button" onclick="handleSignInClick()">Sign In</button>
    <button id="signout-button" onclick="handleSignOutClick()">Sign Out</button>
    <button id="apitest-button" onclick="makeApiCall()">Test API</button>
</body>
</html>
